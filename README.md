# Chuck Norris Quote Discord Bot

A serverless application that generates and sends unique Chuck Norris quotes to a Discord channel using AI. The system automatically generates new quotes and ensures no duplicates are sent.

## Architecture Overview

This project uses several AWS services in a serverless architecture:

- **AWS Lambda** - Serverless compute
- **DynamoDB** - NoSQL database for quote storage
- **EventBridge** - Scheduled task execution
- **Secrets Manager** - Secure storage of API keys
- **IAM** - Security and access management

### Components

1. **Quote Generator** (`QuoteGenerator` Lambda)
   - Uses OpenAI's GPT-3.5 to generate 2 unique Chuck Norris quotes
   - Runs daily at 12:00 PM UTC
   - Checks for similarity with existing quotes to prevent duplicates using a similarity threshold of 0.6 with the `similar()` function
   - Stores new quotes in DynamoDB

2. **Quote Sender** (`DailyQuoteSender` Lambda)
   - Sends quotes to Discord via webhook
   - Runs daily at 9:00 AM UTC
   - Tracks sent quotes to prevent duplicates
   - Automatically resets when all quotes have been sent

3. **DynamoDB Table**
   - Stores quotes with unique IDs
   - Tracks which quotes have been sent
   - Uses a Global Secondary Index for efficient quote status tracking

## Directory Structure

```
.
├── README.md
├── lambda/
│   ├── quote_generator/
│   │   └── quote_generator.py
│   └── daily_quote_sender/
│       └── daily_quote_sender.py
├── lambda_layer/
│   ├── openai_layer.zip
│   └── discord_layer.zip
└── terraform/
    ├── main.tf
    ├── variables.tf
    ├── data.tf
    ├── outputs.tf
    └── terraform.tfvars
```

## Prerequisites

- AWS Account
- Terraform installed (v1.0+)
- Discord server with webhook access
- OpenAI API key

## Setup Instructions

1. **Clone the Repository**
   ```bash
   git clone <repository-url>
   cd <repository-name>
   ```

2. **Create Lambda Layers**
   
   Create a directory called `lambda_layer` in the root of the repository.
   Create two zip files in the `lambda_layer` directory (recommended to do this in a linux environment (WSL2)):
   
   For OpenAI Layer (`openai_layer.zip`):
   ```bash
   pip install openai -t python
   zip -r openai_layer.zip python/
   ```

   For Discord Layer (`discord_layer.zip`):
   ```bash
   pip install requests -t python
   zip -r discord_layer.zip python/
   ```

3. **Configure Variables**
   
   Create a `terraform.tfvars` file:
   ```hcl
   aws_region          = "your-region"
   discord_webhook_url = "your-discord-webhook-url"
   openai_api_key      = "your-openai-api-key"
   ```

4. **Deploy Infrastructure**
   ```bash
   cd terraform
   terraform init
   terraform plan
   terraform apply -var-file="terraform.tfvars"
   ```

## How It Works

1. The Quote Generator runs daily at 12:00 PM UTC:
   - Generates 2 new unique quotes using OpenAI
   - Checks for similarity with existing quotes
   - Stores new quotes in DynamoDB with `Sent = 0`

2. The Quote Sender runs daily at 9:00 AM UTC:
   - Retrieves a random unsent quote (`Sent = 0`)
   - Sends it to Discord via webhook
   - Marks the quote as sent (`Sent = 1`)
   - When all quotes are sent, resets all quotes to unsent

## Security

- API keys are stored in AWS Secrets Manager
- IAM roles follow the principle of least privilege
- Lambda functions use custom IAM roles with specific permissions
- Sensitive variables are marked as sensitive in Terraform

## Customization

- Adjust the schedule in `main.tf` by modifying the `schedule_expression`
- Change the number of quotes generated by modifying `quotes_needed` in `quote_generator.py`
- Adjust similarity threshold in `similar()` function in `quote_generator.py`

## Cleanup

To remove all resources:
```bash
terraform destroy
```

